<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:pe="http://primefaces.org/ui/extensions"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">


	<h:form id="frmProcedimientoEje">
		<p:panel rendered="#{proejeMB.status ne 'SEARCH'}">

			<div align="left" style="margin-top: 50px; float: left;">
				<p:commandButton id="btnCancel" action="#{proejeMB.onCancel}"
					value="Regresar" icon="pi pi-arrow-left" style="float:left;"
					styleClass="pink-btn raised-btn"
					update=":frmProgramaEje, :frmProcedimientoEje" process="@this">
				</p:commandButton>

				<p:commandButton value="Guardar" icon="fa fa-check"
					rendered="#{proejeMB.perEdit}" styleClass="raised-btn"
					actionListener="#{proejeMB.onSave}" update=":frmProcedimientoEje" />
			</div>

			<div align="right" style="margin-top: 50px; float: right;" id="dbts">
				<p:commandButton id="btnNarrativa"
					title="Clic para generar la narrativa del procedimiento"
					process="@this" value="Generar Narrativa" icon="pi pi-check-circle"
					style="float:left;" styleClass="raised-btn" ajax="false">
					<p:fileDownload value="#{proejeMB.narrativa}"></p:fileDownload>
				</p:commandButton>

				<p:commandButton id="btnEnviar" oncomplete="PF('wvCorreoRev').show();"
					actionListener="#{proejeMB.prepararCorreo}"
					rendered="#{proejeMB.registro.pejEstado eq 1 and proejeMB.perEnviar}"
					title="Clic para enviar a revisión de la coordinación el programa de planificación"
					process="@this" value="Enviar a Revisión" icon="pi pi-check-circle"
					style="float:left;" styleClass="blue-btn raised-btn"
					update=":frmCorreoRev">
				</p:commandButton>

				<p:commandButton id="btnEnviarObs"
					oncomplete="PF('wvCorreoObs').show();"
					actionListener="#{proejeMB.prepararCorreoObs}"
					rendered="#{proejeMB.registro.pejEstado eq 2 and proejeMB.perAutorizar}"
					title="Clic para enviar las observaciones al auditor"
					process="@this" value="Comunicar Observaciones"
					icon="pi pi-check-circle" style="float:left;"
					styleClass="blue-btn raised-btn" update=":frmCorreoObs">
				</p:commandButton>

				<p:commandButton id="btnFin" oncomplete="PF('wvCorreoFin').show();"
					actionListener="#{proejeMB.prepararCorreoFin}"
					rendered="#{proejeMB.registro.pejEstado eq 2 and proejeMB.perAutorizar}"
					title="Clic para finalizar la revisión" process="@this"
					value="Finalizar Revisión" icon="pi pi-check-circle"
					style="float:left;" styleClass="blue-btn raised-btn"
					update=":frmCorreoFin">
				</p:commandButton>
			</div>
			<div class="name" align="center" style="margin-top: 100px;">
				<h:outputText rendered="#{proejeMB.registro.pejEstado eq 1}"
					style="float:right; font-size:large; font-weight: bold; color:#2ab1be;"
					value="Elaboración"></h:outputText>
				<h:outputText rendered="#{proejeMB.registro.pejEstado eq 2}"
					style="float:right; font-size:large; font-weight: bold; color:#2ab1be;"
					value="Revisión"></h:outputText>
				<h:outputText rendered="#{proejeMB.registro.pejEstado eq 3}"
					style="float:right; font-size:large; font-weight: bold; color:#2ab1be;"
					value="Finalizado"></h:outputText>
				<h:outputText
					style="float:right; font-size:large; font-weight: bold; color:#525c65; margin-right:10px;"
					value="Estado:"></h:outputText>
				<span class="app-name">Desarrollo de Procedimiento de
					Ejecución </span>
			</div>
			<div class="ui-fluid p-formgrid p-grid">
				<p:tabView id="tview">
					<p:tab title="Procedimiento">
						<p:panelGrid columns="1" columnClasses="ui-g-12" layout="grid"
							styleClass="ui-panelgrid-blank form-group form-elements">

							<p:outputLabel for="nombre" value="Nombre:"
								style="font-weight:bold;" />
							<p:inputTextarea id="nombre" readonly="true"
								value="#{proejeMB.registro.pejNombre}" rows="2" maxlength="250" />

							<p:outputLabel for="ref" value="Referencia:"
								style="font-weight:bold;" />
							<p:inputText id="ref" value="#{proejeMB.registro.pejReferencia}"
								required="true" readonly="true" />

							<p:outputLabel for="des" value="Descripción:"
								style="font-weight:bold;" />
							<p:inputTextarea id="des" readonly="true"
								value="#{proejeMB.registro.pejDescripcion}" rows="2"
								required="true" maxlength="250" />
						</p:panelGrid>

					</p:tab>
					<p:tab title="Narrativa">
						<p:panelGrid columns="1" columnClasses="ui-g-12" layout="grid"
							styleClass="ui-panelgrid-blank form-group form-elements">

							<p:outputLabel for="narra" value="Narrativa"
								style="font-weight:bold;" />
							<pe:ckEditor id="narra" width="100%" skin="office2013"
								readonly="#{!proejeMB.perEdit or proejeMB.registro.pejEstado ne 1}"
								customConfig="#{request.contextPath}/resources/js/customck.js"
								value="#{proejeMB.registro.pejNarrativa}" />
						</p:panelGrid>
					</p:tab>
					<p:tab title="Papeles de Trabajo">
						<p:panelGrid columns="1" columnClasses="ui-g-12" layout="grid"
							styleClass="ui-panelgrid-blank form-group form-elements">
							<h:outputText value="Subida de archivos:"></h:outputText>
							<p:fileUpload listener="#{proejeMB.handleFileUpload}"
								disabled="#{proejeMB.status eq 'NEW' or !proejeMB.perEdit or proejeMB.registro.pejEstado ne 1}"
								multiple="true" mode="advanced" dragDropSupport="false"
								cancelLabel="Cancelar" uploadLabel="Subir" label="Elegir"
								update=":frmProcedimientoEje:tview:dtArchivos"
								allowTypes="/(\.|\/)(gif|jpe?g|png|doc|docx|xls|xlsx|pdf|ppt|pptx)$/" />
						</p:panelGrid>
						<p:dataTable var="a" value="#{arcMB.listado}" rowIndexVar="index"
							widgetVar="wvArchivos" reflow="true" id="dtArchivos"
							style="margin-top:20px;" paginator="true" paginatorPosition="top"
							rowsPerPageTemplate="1,5,10,15" rows="5"
							paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
							rowKey="#{a.arcId}">

							<p:column headerText="No.">
								<h:outputText value="#{index+1}"></h:outputText>
							</p:column>

							<p:column headerText="Nombre" filterBy="#{a.arcNombre}"
								filterMatchMode="contains">
								<h:outputText value="#{a.arcNombre}"></h:outputText>
							</p:column>

							<p:column headerText="Descargar"
								style="width:60px; text-align:center;">
								<p:commandButton actionListener="#{arcMB.downloadFile}"
									ajax="false" icon="ui-icon-arrowthick-1-s"
									title="Clic para descargar el archivo">
									<f:attribute name="pt" value="#{a}"></f:attribute>
									<p:fileDownload value="#{arcMB.pt}"></p:fileDownload>
								</p:commandButton>
							</p:column>

							<p:column headerText="Eliminar" style="width:60px;">
								<p:commandButton actionListener="#{arcMB.onBorrar(a)}"
									disabled="#{!proejeMB.perEdit or proejeMB.registro.pejEstado ne 1}"
									update=":frmProcedimientoEje:tview:dtArchivos"
									icon="pi pi-trash" title="Clic para eliminar el archivo">
									<p:confirm header="Confirmación" message="¿Eliminar?"
										icon="pi pi-info-circle"></p:confirm>
								</p:commandButton>
							</p:column>

						</p:dataTable>
					</p:tab>

					<p:tab title="Observaciones de Coordinación">
						<p:panelGrid columns="1" columnClasses="ui-g-12" layout="grid"
							styleClass="ui-panelgrid-blank form-group form-elements">

							<p:outputLabel for="obs" value="Observaciones"
								style="font-weight:bold;" />
							<pe:ckEditor id="obs" width="100%" skin="office2013"
								readonly="#{!proejeMB.perEdit or proejeMB.registro.pejEstado ne 2}"
								customConfig="#{request.contextPath}/resources/js/customck.js"
								value="#{proejeMB.registro.pejObservaciones}" />
						</p:panelGrid>
					</p:tab>
				</p:tabView>

				<p:panelGrid columns="2"
					columnClasses="ui-g-9 ui-lg-10,ui-g-3 ui-md-4 ui-lg-2"
					layout="grid"
					styleClass="ui-panelgrid-blank form-group form-elements">
					<p:column></p:column>
					<p:commandButton value="Guardar" icon="fa fa-check"
						rendered="#{proejeMB.perEdit}" actionListener="#{proejeMB.onSave}"
						update=":frmProcedimientoEje" />
				</p:panelGrid>
			</div>

		</p:panel>

	</h:form>

	<p:dialog widgetVar="wvCorreoRev" modal="true" showEffect="fade"
		closable="true" closeOnEscape="true" responsive="true">
		<h:form id="frmCorreoRev">
			<p:commandButton id="btnEnviar" action="#{proejeMB.onEnviarRevision}"
				title="Clic para enviar a revisión de la coordinación el programa de planificación"
				process=":frmCorreoRev" value="Enviar procedimiento a Revisión"
				icon="pi pi-check-circle" style="float:left;"
				styleClass="blue-btn raised-btn" oncomplete="PF('wvCorreoRev').hide();"
				update=":frmProgramaEje, :frmProcedimientoEje">
				<p:confirm header="Confirmación" message="¿Enviar procedimiento a revisión?"></p:confirm>
			</p:commandButton>
			<p:panelGrid columns="1" columnClasses="ui-g-12" layout="grid"
				styleClass="ui-panelgrid-blank form-group form-elements">
				<p:outputLabel for="narra" value="Digite el texto del correo:"
					style="font-weight:bold;" />
				<pe:ckEditor id="narra" width="100%" value="#{proejeMB.textoCorreo}"
					skin="office2013"
					customConfig="#{request.contextPath}/resources/js/customck.js" />
			</p:panelGrid>
		</h:form>
	</p:dialog>

	<p:dialog widgetVar="wvCorreoObs" modal="true" showEffect="fade"
		closable="true" closeOnEscape="true" responsive="true">
		<h:form id="frmCorreoObs">
			<p:commandButton id="btnEnviar"
				action="#{proejeMB.onEnviarObservacion}"
				title="Clic para enviar las observaciones al auditor"
				process=":frmCorreoObs" value="Comunicar Observaciones"
				icon="pi pi-check-circle" style="float:left;"
				styleClass="blue-btn raised-btn"
				oncomplete="PF('wvCorreoObs').hide();"
				update=":frmProgramaEje, :frmProcedimientoEje">
				<p:confirm header="Confirmación" message="¿Enviar observaciones?"></p:confirm>
			</p:commandButton>
			<p:panelGrid columns="1" columnClasses="ui-g-12" layout="grid"
				styleClass="ui-panelgrid-blank form-group form-elements">
				<p:outputLabel for="narra" value="Digite el texto del correo:"
					style="font-weight:bold;" />
				<pe:ckEditor id="narra" width="100%" skin="office2013"
					customConfig="#{request.contextPath}/resources/js/customck.js"
					value="#{proejeMB.textoCorreoObs}" />
			</p:panelGrid>
		</h:form>
	</p:dialog>

	<p:dialog widgetVar="wvCorreoFin" modal="true" showEffect="fade"
		closable="true" closeOnEscape="true" responsive="true">
		<h:form id="frmCorreoFin">
			<p:commandButton id="btnEnviar" action="#{proejeMB.onFinalizar}"
				title="Clic para finalizar la revisión del programa de planificación"
				process=":frmCorreoFin" value="Finalizar Revisión"
				icon="pi pi-check-circle" style="float:left;"
				styleClass="blue-btn raised-btn"
				oncomplete="PF('wvCorreoFin').hide();"
				update=":frmProgramaEje, :frmProcedimientoEje">
				<p:confirm header="Confirmación" message="¿Finalizar Revisión?"></p:confirm>
			</p:commandButton>
			<p:panelGrid columns="1" columnClasses="ui-g-12" layout="grid"
				styleClass="ui-panelgrid-blank form-group form-elements">
				<p:outputLabel for="narra" value="Digite el texto del correo:"
					style="font-weight:bold;" />
				<pe:ckEditor id="narra" width="100%" skin="office2013"
					customConfig="#{request.contextPath}/resources/js/customck.js"
					value="#{proejeMB.textoCorreoFin}" />
			</p:panelGrid>
		</h:form>
	</p:dialog>

</ui:composition>
