<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pe="http://primefaces.org/ui/extensions">

	<h:form id="frmSeguimiento">
		<p:panel rendered="#{comMB.status eq 'SEARCH'}">
			<div align="left" style="margin-top: 50px;">
				<p:commandButton id="btnCancel" actionListener="#{recMB.onCancel}"
					process="@this" value="Regresar" icon="pi pi-arrow-left"
					style="float:left;" update="@form"
					action="/page/planeacion/auditoria.xhtml">
				</p:commandButton>
			</div>
			<div class="name" align="center" style="margin-top: 100px;">
				<span class="app-name">Seguimiento Hallazgos de Auditoría </span>
			</div>

			<div class="ui-fluid p-formgrid p-grid">
				<p:panelGrid columns="1" columnClasses="ui-g-12" layout="grid"
					styleClass="ui-panelgrid-blank form-group form-elements">

					<p:outputLabel for="audSeg" value="Auditoría:"
						style="font-weight:bold;" />
					<p:inputTextarea id="audSeg" value="#{segMB.auditoria.audNombre}"
						rows="2" readonly="true" />

					<p:outputLabel for="fechainicio" value="Fecha inicio seguimiento:"
						style="font-weight:bold;" />
					<p:outputLabel id="fechainicio"
						value="#{segMB.registro.segFecInicio}">
						<f:convertDateTime pattern="dd-MM-yyyy" />
					</p:outputLabel>

					<p:outputLabel for="fechafin" value="Fecha fin:"
						style="font-weight:bold;" />
					<p:outputLabel id="fechafin" value="#{segMB.registro.segFecFin}">
						<f:convertDateTime pattern="dd-MM-yyyy" />
					</p:outputLabel>

					<p:outputLabel value="Auditores Asignados"
						style="font-weight:bold;" />
					<p:dataGrid id="listAuditores" value="#{segMB.auditoresList}"
						var="aud" columns="1">
						<h:outputText value="#{aud.usuNombre} #{aud.usuApellido}" />
					</p:dataGrid>
					<p:separator />
				</p:panelGrid>
			</div>
			<div class="ui-fluid p-formgrid p-grid">
				<p:tabView id="tvSeguimientoAuditoria">
					<p:tab title="Seguimiento">
						<div class="ui-fluid p-formgrid p-grid">
							<p:panelGrid columnClasses="ui-lg-1,ui-lg-1,ui-lg-1,ui-lg-1"
								styleClass="ui-panelgrid-blank form-group form-elements">
								<p:row>
									<p:column>
										<p:outputLabel value="Indicaciones generales para el auditor" />
									</p:column>

									<p:column colspan="2">
										<p:inputTextarea id="indicaciones"
											value="#{segMB.registro.segObservacion}" rows="4" cols="300" />
									</p:column>
								</p:row>
							</p:panelGrid>

						</div>
						<p:panelGrid style="width:100%"
							styleClass="ui-panelgrid-blank form-group form-elements">
							<p:row style="text-align:center;">
								<p:column>
									<p:commandButton id="btnNotificarSeguimiento"
										oncomplete="PF('wvCorreo').show();"
										actionListener="#{segMB.prepararCorreo}"
										value="Notificar Seguimiento" styleClass="blue-btn"
										title="Clic para enviar la notificacion" process="@form"
										icon="pi pi-check-circle" style="float:Righ;"
										rendered="#{segMB.registro.segFecInicio != null and segMB.registro.segFecFin == null}" />
								</p:column>
								<p:column>
									<p:commandButton id="btnIniciarSeguimiento"
										value="Iniciar Seguimiento" styleClass="blue-btn"
										actionListener="#{segMB.iniciarSeguimiento}" update="@form"
										rendered="#{segMB.registro.segFecInicio == null}" />
									<p:commandButton id="btnFinalizarSeguimiento"
										value="Finalizar Seguimiento"
										actionListener="#{segMB.finalizarSeguimiento}" update="@form"
										rendered="#{segMB.registro.segFecInicio != null and segMB.registro.segFecFin == null}">
									</p:commandButton>
								</p:column>
								<p:column>
									<p:commandButton id="btnGuardarSeguimiento"
										value="Guardar Seguimiento" icon="fa fa-check"
										actionListener="#{segMB.onSave}" styleClass="green-btn"
										rendered="#{segMB.registro.segFecFin == null}" />
								</p:column>
							</p:row>
						</p:panelGrid>
						<p:dataTable var="ced" value="#{segMB.cedulaNotaList}"
							expandedRow="single" expandableRowGroups="true"
							widgetVar="wvHallazgos" id="dtHallazgos" style="margin-top:20px;"
							paginator="true" rowKey="#{ced.cedId}" rowIndexVar="cedIndex"
							selection="#{segMB.cedulaSelected}" selectionMode="single"
							paginatorPosition="bottom" rowsPerPageTemplate="5,10,15" rows="5"
							paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros">
							<p:ajax event="rowSelect" listener="#{segMB.onCedulaSelected}"
								update="dtHallazgos:tMenuHallazgos" />
							<f:facet name="header"> Listado de Hallazgos
								<p:toolbar id="tMenuHallazgos">
									<p:toolbarGroup>
										<p:commandButton id="btnRecomendaciones" value="Comentarios"
											icon="pi pi-plus"
											rendered="#{segMB.cedulaSelected.selected and segMB.registro.segFecInicio != null}"
											action="#{segMB.mostrarComentarios}"
											update="@form :frmComentarios" styleClass="raised-btn"
											process="@this">
										</p:commandButton>
									</p:toolbarGroup>
								</p:toolbar>
							</f:facet>
							<p:column headerText="No." style="text-align:center; width:50px;">
								<h:outputText value="#{cedIndex+1}"></h:outputText>
							</p:column>

							<p:column headerText="Título">
								<h:outputText value="#{ced.cedTitulo}"></h:outputText>
							</p:column>

							<p:column headerText="Condición">
								<h:outputText value="#{ced.cedCondicion}"></h:outputText>
							</p:column>

							<p:column headerText="Criterio">
								<h:outputText value="#{ced.cedCriterio}"></h:outputText>
							</p:column>

							<p:column headerText="Estado"
								style="text-align:center; width:100px;">
								<h:outputText value="#{ced.cedEstado}" converter="estadoHallazgo">
								</h:outputText>
							</p:column>
						</p:dataTable>
					</p:tab>
					<p:tab title="Historial Seguimiento">
						<p:dataTable var="seg" value="#{segMB.listado}"
							rowIndexVar="indexSeguimiento" widgetVar="wvSeguimientos"
							reflow="true" id="dtSeguimientos" style="margin-top:20px;"
							paginator="true" selectionMode="single" rows="5"
							selection="#{segMB.seguimientoSelected}"
							paginatorPosition="bottom" rowsPerPageTemplate="5,10,15"
							paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
							currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros"
							rowKey="#{seg.segId}">
							<p:ajax event="rowSelect"
								update="dtSeguimientos:tMenuSeguimientos"
								listener="#{segMB.onRowSeguimientoSelected}" />
							<f:facet name="header">
								<p:toolbar id="tMenuSeguimientos">
									<p:toolbarGroup>
										<p:commandButton id="btnRecSeguimiento"
											value="Recomendaciones y Comentarios" icon="pi pi-plus"
											rendered="#{segMB.seguimientoSelected.selected}"
											action="#{segMB.obtenerRecomendacionesSeguimiento()}"
											update=":dgRecomendacionesSeguimiento"
											oncomplete="PF('wvRecomendacionesSeguimiento').show();"
											styleClass="raised-btn">
										</p:commandButton>
									</p:toolbarGroup>
								</p:toolbar>
							</f:facet>
							<p:column headerText="N°" width="60" style="text-align:center;">
								<h:outputText value="#{indexSeguimiento+1}" />
							</p:column>
							<p:column headerText="Comentario">
								<h:outputText value="#{seg.segObservacion}">
								</h:outputText>
							</p:column>
							<p:column headerText="Fecha Inicio">
								<h:outputText value="#{seg.segFecInicio}">
									<f:convertDateTime pattern="dd-MM-yyyy" />
								</h:outputText>
							</p:column>
							<p:column headerText="Fecha Fin">
								<h:outputText value="#{seg.segFecFin}">
									<f:convertDateTime pattern="dd-MM-yyyy" />
								</h:outputText>
							</p:column>
						</p:dataTable>
					</p:tab>
				</p:tabView>
			</div>

		</p:panel>
	</h:form>

	<p:dialog id="dgRecomendacionesSeguimiento" maximizable="true"
		widgetVar="wvRecomendacionesSeguimiento" responsive="true"
		minHeight="650" closeOnEscape="true" position="center"
		header="Historial Recomendaciones" modal="true">
		<p:ajax event="close" update=":frmSeguimiento"
			listener="#{recMB.actualizarSeguimiento}" />
		<h:form id="frmRecomendacionesSeguimiento">
			<p:dataTable var="hrecm"
				value="#{segMB.recomendacionesSeguimientoList}" expandedRow="single"
				expandableRowGroups="true" sortBy="#{hrecm.cedulaNota.cedTitulo}"
				widgetVar="wvRecomendacionesHist" id="dtRecomendacionHist"
				style="margin-top:20px;" paginator="true" rowKey="#{hrecm.recId}"
				paginatorPosition="bottom" rowsPerPageTemplate="5,10,15" rows="5"
				paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
				currentPageReportTemplate="{startRecord}-{endRecord} de {totalRecords} registros">
				<p:headerRow>
					<p:column colspan="4">
						<h:outputText value="Hallazgo: #{hrecm.cedulaNota.cedTitulo}"></h:outputText>
					</p:column>
				</p:headerRow>
				<p:column headerText="Titulo Recomendación">
					<h:outputText value="#{hrecm.recTitulo}"></h:outputText>
				</p:column>
				<p:column headerText="Situación Encontrada">
					<h:outputText value="#{hrecm.recSituacion}"></h:outputText>
				</p:column>
				<p:column headerText="Estado" width="150" style="text-align:center">
					<h:outputText value="#{hrecm.recEstado}"
						converter="estadoRecomendacion"></h:outputText>
				</p:column>
				<p:column headerText="Comentarios">
					<p:commandButton id="btnComentarioHist" icon="ui-icon ui-icon-note"
						action="#{segMB.mostrarComentariosHistorial}"
						update=":dgComentarioRecHistorial" process="@this"
						oncomplete="PF('wvComentarioRecHistorial').show(); PF('wvComentarioRecHistorial').toggleMaximize();">
						<f:setPropertyActionListener value="#{hrecm}"
							target="#{segMB.recomendacionSelected}" />
					</p:commandButton>
				</p:column>
			</p:dataTable>
		</h:form>
	</p:dialog>

	<p:dialog id="dgComentarioRecHistorial" maximizable="true"
		widgetVar="wvComentarioRecHistorial" responsive="true" minHeight="650"
		closeOnEscape="true" header="Historial Comentario" modal="true">
		<h:form id="frmComentarioRecHistorial">

			<p:tabView id="tvComentariosRecHistorial">
				<p:tab title="Comentarios de Unidad(es) Auditada(s)">
					<pe:ckEditor id="comentarioAuditadoHist" width="100%"
						value="#{comMB.registro.comComentario}"
						readonly="#{!comMB.rolAuditado}" />
				</p:tab>
				<p:tab title="Comentarios de Auditoría">
					<pe:ckEditor id="comentarioAuditariaHist" width="100%"
						value="#{comMB.registro.comComentarioAuditoria}"
						readonly="#{!comMB.rolAuditor}" />
				</p:tab>
			</p:tabView>
		</h:form>
	</p:dialog>

</ui:composition>
