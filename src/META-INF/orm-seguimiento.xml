<?xml version="1.0" encoding="UTF-8"?>
<entity-mappings version="2.0"
	xmlns="http://java.sun.com/xml/ns/persistence/orm"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://java.sun.com/xml/ns/persistence/orm http://java.sun.com/xml/ns/persistence/orm_2_0.xsd">

	<named-query name="seguimiento.get.by.auditoria">
		<query>select o from Seguimiento o where o.auditoria.audId = ?1 and o.regActivo = 1 and o.segEstado=1 order by o.segFecInicio ASC</query>
	</named-query>
	
	<named-query name="historial.seguimiento.get.by.auditoria">
		<query>select o from Seguimiento o where o.auditoria.audId = ?1 and o.regActivo = 1 order by o.segFecInicio ASC</query>
	</named-query>
	
	<named-query name="seguimiento.get.by.auditoria.finalizados">
		<query>select o from Seguimiento o where o.auditoria.audId = ?1 and o.regActivo = 1 and o.segEstado=2 order by o.segFecFin DESC</query>
	</named-query>

	<named-query name="recomendacion.get.all.auditoria">
		<query>select o from Recomendacion o where o.auditoria.audId = ?1 and (o.recEstado = 1 or o.recEstado = 3) and o.regActivo = 1 order by o.cedulaNota.cedId</query>
	</named-query>

	<named-query name="comentario.by.hallazgo.seguimiento">
		<query>select o from Comentario o where o.seguimiento.segId = ?1 and o.cedulaNota.cedId = ?2 and o.regActivo = 1</query>
	</named-query>
	<named-query name="hallazgos.by.auditoria">
		<query>select o from CedulaNota o where o.auditoria.audId = ?1 and o.regActivo = 1</query>
	</named-query>
	<named-query
		name="seguimiento.recomendaciones.seguimiento.selected">
		<query>select o from Recomendacion o where o.seguimiento.segId = ?1 and o.regActivo = 1 </query>
	</named-query>
	<named-query name="seguimiento.auditores.asignados">
		<query>select o.usuario from AuditoriaResponsable o where o.auditoria.audId = ?1 and o.regActivo = 1</query>
	</named-query>
	<named-query name="cedula.nota.por.auditoria">
		<query>select distinct o from CedulaNota o left join fetch o.comentarioHallazgos where o.auditoria.audId = ?1 and o.seguimiento is null and o.cedValorizacion not in (2) and o.regActivo = 1</query>
	</named-query>
	<named-query name="cedula.nota.seguimiento.por.auditoria">
		<query>select o from CedulaNota o where o.auditoria.audId = ?1 and o.seguimiento.segId=?2 and o.cedValorizacion not in (2) and o.regActivo = 1</query>
	</named-query>
	<named-query name="recomendaciones.cedula.nota">
		<query>select o from Recomendacion o where o.cedulaNota.cedId = ?1 and (o.recEstado = 1 or o.recEstado = 3) and o.regActivo = 1 </query>
	</named-query>
	<named-query name="seguimiento.hallazgo.auditoria.auditado">
		<query>select o from CedulaNota o where o.regActivo = 1 and (o.cedEstado between 9 and 10) and o.auditoria.audId in 
			(select a.auditoria.audId from Seguimiento a where a.segFecFin is null and a.regActivo = 1 and a.auditoria.planAnual.institucion.insId = ?1)
		</query>
	</named-query>
	<named-query
		name="seguimiento.recomendaciones.por.seguimiento">
		<query>select o from Recomendacion o where o.cedulaNota.cedId = ?1</query>
	</named-query>
	
	<named-query name="hallazgos.by.seguimiento">
		<query>select distinct o from CedulaNota o left join fetch o.comentarioHallazgos 
				where o.seguimiento.segId=?1 and o.regActivo=1</query>
	</named-query>
</entity-mappings>
